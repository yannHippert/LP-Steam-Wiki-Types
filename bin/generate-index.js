const fs = require('fs');
const path = require('path');

const typesFolder = 'source';
const dateFormatter = new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
});

function getExportsFiles(folderPath) {
    const items = fs.readdirSync(folderPath, { withFileTypes: true });
    let exportFiles = [];
    for (const item of items) {
        const itemPath = path.join(folderPath, item.name);
        if (item.isDirectory()) {
            exportFiles = exportFiles.concat(getExportsFiles(itemPath));
        } else if (item.isFile() && item.name.endsWith('.ts')) {
            const filePath = path.relative(path.resolve(__dirname, '..'), itemPath).replace(/\\/g, '/');
            exportFiles.push(filePath.slice(0, -3));
        }
    }
    return exportFiles;
}

const exportFiles = getExportsFiles(path.resolve(__dirname, '..', typesFolder));

// const packageName = 'steam-wiki';
// fs.writeFileSync(
//     path.resolve(__dirname, '..', 'index.d.ts'),
//     `/*
//  * This file is autogenerated and should not be changed manually!
// */\r\n
// declare module '${packageName}' {
//     ${exportsLines.join('\r\n\t')}
// }
// `,
// );

fs.writeFileSync(
    path.resolve(__dirname, '..', 'index.ts'),
    `/*
 * This file is autogenerated and should not be changed manually!
 * Created: ${dateFormatter.format(new Date())}
*/\r\n
${exportFiles.map((fileName) => `export * from './${fileName}';`).join('\r\n')}
`,
);
